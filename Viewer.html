<!-- ðŸŽ¬ FSA Media Viewer -->
<div id="fsa-viewer" style="font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif; max-width:900px; margin:20px auto; padding:20px; background:#fff; border:1px solid #ddd; border-radius:10px; box-shadow:0 4px 12px rgba(0,0,0,.1);">
  <h2 style="margin:0 0 12px; font-size:1.4rem; color:#111827;">ðŸ¦… Adler Media Rotator</h2>

  <!-- ðŸ“œ Laufband -->
  <div id="laufband" style="background:#0f172a; color:#f8fafc; padding:8px 0; margin-bottom:12px; border-radius:6px; overflow:hidden;">
    <marquee id="laufband-text" behavior="scroll" direction="left" scrollamount="6" style="font-size:1rem; font-weight:500;">
      Lade Laufband ...
    </marquee>
  </div>

  <!-- ðŸŽ¥ Rotator-Bereich -->
  <div id="video-rotator" style="position:relative; width:100%; height:480px; background:#000; border-radius:8px; overflow:hidden;">
    <div id="video-container" style="width:100%; height:100%;"></div>
  </div>
</div>

<script>
(async function(){
  // --- ðŸ“œ Laufband laden ---
  try {
    const resLB = await fetch("laufband.json");
    const texte = await resLB.json();
    document.getElementById("laufband-text").textContent = texte.join("   |   ");
  } catch(e){
    document.getElementById("laufband-text").textContent = "âš ï¸ Laufband konnte nicht geladen werden.";
  }

  // --- ðŸŽµ Playlist laden ---
  const response = await fetch("playlist.json");
  const playlist = await response.json();

  // Trennen: Audio / Video
  const audioTracks = playlist.filter(item => item.src.endsWith(".mp3"));
  const videoTracks = playlist.filter(item =>
    item.src.endsWith(".mp4") || item.src.includes("youtube.com") || item.src.includes("youtu.be")
  );

  // ðŸŽµ Audio im Hintergrund abspielen (alle MP3s nacheinander)
  if(audioTracks.length > 0){
    let currentAudio = 0;
    const audio = document.createElement("audio");
    audio.autoplay = true;
    audio.loop = false; // wir steuern den Loop selbst
    audio.volume = 0.5;
    audio.style.display = "none";
    document.body.appendChild(audio);

    function playAudio(index){
      audio.src = audioTracks[index].src;
      audio.play().catch(e => console.warn("Autoplay blockiert:", e));
    }

    audio.addEventListener("ended", () => {
      currentAudio = (currentAudio + 1) % audioTracks.length;
      playAudio(currentAudio);
    });

    // Starte mit erstem Song
    playAudio(currentAudio);
  }

  // ðŸŽ¥ Video Rotator
  let currentVideo = 0;
  const videoContainer = document.getElementById("video-container");

  function showVideo(index){
    const track = videoTracks[index];
    videoContainer.innerHTML = ""; // Container leeren

    if(track.src.endsWith(".mp4")){
      // Lokales Video
      const video = document.createElement("video");
      video.src = track.src;
      video.controls = true;
      video.autoplay = true;
      video.loop = false;
      video.style.width = "100%";
      video.style.height = "100%";
      videoContainer.appendChild(video);

      video.onended = () => nextVideo();
    } else {
      // YouTube
      const iframe = document.createElement("iframe");
      iframe.src = track.src.replace("youtu.be/","www.youtube.com/embed/").split("?")[0] + "?autoplay=1&rel=0";
      iframe.width = "100%";
      iframe.height = "100%";
      iframe.allow = "autoplay; encrypted-media";
      iframe.style.border = "0";
      videoContainer.appendChild(iframe);

      // YouTube automatisch nach 30s weiterschalten (kann angepasst werden)
      setTimeout(() => nextVideo(), 30000);
    }
  }

  function nextVideo(){
    currentVideo = (currentVideo + 1) % videoTracks.length;
    showVideo(currentVideo);
  }

  // Starte Rotator
  if(videoTracks.length > 0){
    showVideo(currentVideo);
  }

})();
</script>
